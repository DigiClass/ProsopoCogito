@(docId: Int, filepartId: Int, content: String)
<!DOCTYPE html>
<html>
  <head>
    <script src="@routes.Assets.versioned("lib/jquery/jquery.min.js")"></script>
    <script src="@routes.Assets.versioned("lib/rangy/rangy-core.min.js")"></script>
    <style>
      p {
        max-width:736px;
        margin:30px auto;
        line-height:170%;
        font-size:17px;
      }

      .entity.PLACE {
        background-color:rgba(255, 0, 0, 0.3);
      }

      .entity.PERSON {
        background-color:rgba(0, 0, 255, 0.3);
      }
    </style>
  </head>
  <body>
    <p id="content">@content</p>
    <script>
      jQuery.getJSON('@controllers.annotation.routes.TextAnnotationController.getAnnotationsFor(filepartId)', function(data) {
        var p = document.getElementById('content').childNodes[0],

            ranges = jQuery.map(data, function(annotation) {
              var anchor = annotation.anchor.substr(12),

                  quote = jQuery.grep(annotation.bodies, function(b) {
                            return b.type === 'QUOTE';
                          })[0].value,

                  entity = jQuery.grep(annotation.bodies, function(b) {
                             return b.type === 'PERSON' || b.type === 'PLACE';
                           })[0].type;

                  range = rangy.createRange();

              range.setStart(p, parseInt(anchor));
              range.setEnd(p, parseInt(anchor) + quote.length);

              // Bad hack - just so that we can see something now
              range.entity_type = entity;

              return range;
            });

        jQuery.each(ranges, function(idx, range) {
          var wrapper = document.createElement('SPAN');
          wrapper.className = 'entity ' + range.entity_type;
          range.surroundContents(wrapper);
        });
      });
    </script>
  </body>
</html>
