@() @*document: models.generated.tables.records.DocumentRecord, fileparts: Seq[models.generated.tables.records.DocumentFilepartRecord], applyNER: Boolean)*@
<!DOCTYPE html>
<html>
  <head>
    <title>My Recogito - Organize Document</title>
    <link rel="stylesheet" href="@routes.Assets.versioned("stylesheets/myrecogito/upload.css")"/>
    <script src="@routes.Assets.versioned("lib/jquery/jquery.min.js")"></script>
    <script src="@routes.Assets.versioned("lib/jquery-ui/jquery-ui.min.js")"></script>
  </head>
  <body>
    <div id="content">
      <ul id="header-steps">
        <li class="arrow">Enter Metadata</li><li class="arrow">Attach Files</li><li class="active">Import</li>
      </ul>

      <h2>Grab &amp; Drag to Change Order</h2>

      <ul class="fileparts">
        <li class="filepart-preview">
          the-odyssey-1.txt
          <span class="filepart-ner-progress">
            Annotation
            <span class="filepart-ner-progress-current">In Progress...</span>
          </span>
        </li>

        <li class="filepart-preview">
          the-odyssey-3.txt
          <span class="filepart-ner-progress">
            Annotation
            <span class="filepart-ner-progress-current">In Progress...</span>
          </span>
        </li>

        <li class="filepart-preview">
          the-odyssey-4.txt
          <span class="filepart-ner-progress">
            Annotation
            <span class="filepart-ner-progress-current">In Progress...</span>
          </span>
        </li>

        <li class="filepart-preview">
          the-odyssey-2.txt
          <span class="filepart-ner-progress">
            Annotation
            <span class="filepart-ner-progress-current">In Progress...</span>
          </span>
        </li>

        @* for(part <- fileparts) {
          <li class="filepart-preview" data-id="@part.getId">
            <p class="filepart-title">@part.getTitle</p>
            <p class="filepart-ner-progress"></p>
          </li>
        } *@
      </ul>

      <div id="buttons">
        <a href="@controllers.myrecogito.upload.routes.UploadController.showStep2" class="back btn btn-large btn-blue">Back</a>
        <a href="#" class="next btn btn-large btn-blue">OK</a>
      </div>
    </div>

    <script>
      jQuery(document).ready(function() {
        jQuery('ul.fileparts').sortable();
        jQuery('ul.fileparts').disableSelection();
      });
    </script>

    @*
    <script>
      jQuery(document).ready(function() {
            // Document ID
        var docId = @document.getId,

            // Number of fileparts in this document
            hasParts = @fileparts.size,

            NER_PROGRESS_SERVICE_URL = '@controllers.myrecogito.upload.routes.UploadController.queryNERProgress(document.getId)',

            pollNERProgress = function() {
              jQuery.getJSON(NER_PROGRESS_SERVICE_URL, function(data) {
                var workerProgress = data.progress,

                    completedWorkers = jQuery.grep(workerProgress, function(p) {
                      return p.progress == 1.0;
                    }),

                    isComplete = completedWorkers.length === hasParts;

                jQuery.each(workerProgress, function(idx, p) {
                  var div = jQuery('li[data-id="' + p.filepart_id + '"] .filepart-ner-progress');
                  div.html(p.progress);
                });

                if (isComplete)
                  console.log('NER complete.')
                else
                  setTimeout(pollNERProgress, 1000);

              });
            };

        jQuery('ul.fileparts').sortable();
        jQuery('ul.fileparts').disableSelection();
        pollNERProgress();
      });
    </script>*@
  </body>
</html>
